<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Update a choropleth layer by zoom level</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<script src='https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css' rel='stylesheet' />
<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<link rel="stylesheet" href="styles.css">
<nav id="menu-beliefs"></nav>
<nav id="menu-policy"></nav>
<div style="z-index:-1; position: fixed;" id="map"></div>
<div style="z-index:1; position: fixed;" class='map-overlay' id="legend"></div>

<script>

    const layersBeliefs = document.getElementById('menu-beliefs');
    const labelBeliefs = document.createElement("p");
    labelBeliefs.className = 'toggleLabelText';
    labelBeliefs.innerText = "Beliefs";
    layersBeliefs.appendChild(labelBeliefs);

    const layersPolicy = document.getElementById('menu-policy');
    const labelPolicy = document.createElement("p");
    labelPolicy.className = 'toggleLabelText';
    labelPolicy.innerText = "Policy";
    layersPolicy.appendChild(labelPolicy);   

    // RESOURCES:
    // https://docs.mapbox.com/mapbox-gl-js/example/toggle-layers/
    
	mapboxgl.accessToken = 'pk.eyJ1IjoibWVnc3Byb3R0ZSIsImEiOiJjbDAxYnR1MTkwcGkwM2lwbWN2b2M2YTAzIn0.h7kbhUtoxCDNL9-hj6staw';
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v10',
        center: [-98, 38.88],
        minZoom: 3,
        zoom: 3
    });

    const zoomThreshold = 4;

    map.on('load', () => {
        
        // define legend colors
        colors = [
            'rgba(177, 47, 47, 1)',
            'rgba(177, 47, 47, .95)',
            'rgba(177, 47, 47, .9)',
            'rgba(177, 47, 47, .85)',
            'rgba(177, 47, 47, .8)',
            'rgba(177, 47, 47, .75)',
            'rgba(177, 47, 47, .7)',
            'rgba(177, 47, 47, .65)',
            'rgba(177, 47, 47, .6)',
            'rgba(177, 47, 47, .55)',
            'rgba(177, 47, 47, .5)',
            'rgba(177, 47, 47, .45)',
            'rgba(177, 47, 47, .4)',
            'rgba(177, 47, 47, .35)',
            'rgba(177, 47, 47, .3)',
            'rgba(177, 47, 47, .25)',
            'rgba(177, 47, 47, .2)',
            'rgba(177, 47, 47, .15)',
            'rgba(177, 47, 47, .1)',
            'rgba(177, 47, 47, 0.05)',
            'rgba(177, 47, 47, 0)',
            'rgba(38, 161, 44, 0.05)',
            'rgba(38, 161, 44, .1)',
            'rgba(38, 161, 44, .15)',
            'rgba(38, 161, 44, .2)',
            'rgba(38, 161, 44, .25)',
            'rgba(38, 161, 44, .3)',
            'rgba(38, 161, 44, .35)',
            'rgba(38, 161, 44, .4)',
            'rgba(38, 161, 44, .45)',
            'rgba(38, 161, 44, .5)',
            'rgba(38, 161, 44, .55)',
            'rgba(38, 161, 44, .6)',
            'rgba(38, 161, 44, .65)',
            'rgba(38, 161, 44, .7)',
            'rgba(38, 161, 44, .75)',
            'rgba(38, 161, 44, .8)',
            'rgba(38, 161, 44, .85)',
            'rgba(38, 161, 44, .9)',
            'rgba(38, 161, 44, .95)',
            'rgba(38, 161, 44, 1)',

        ];
        
        // create legend
        const legend = document.getElementById('legend');

        const insecure = document.createElement('span');
        insecure.className = 'legendLabelText';
        insecure.innerHTML = 'Insecure';
        legend.appendChild(insecure);
        
        colors.forEach((color) => {
            const itemColor = color;
            const key = document.createElement('span');
            key.className = 'legend-key';

            key.style.backgroundColor = itemColor;
            legend.appendChild(key);
        });

        const secure = document.createElement('span');
        secure.className = 'legendLabelText';
        secure.innerHTML = 'Secure';
        legend.appendChild(secure);

        // YALE
        map.addSource('yale', {
            'type': 'vector',
            'url': 'mapbox://megsprotte.8pll3kfg'
        });
        map.addLayer(
            {
                'id': 'Climate Change is Happening',
                'source': 'yale',
                'source-layer': 'yale-climate-opinion-map-1he0ht',
                'maxzoom': zoomThreshold,
                'type': 'fill',
                // only include features for which the "isState"
                // property is "true"
                'paint': {
                    'fill-color': [
                        "interpolate",
                        ["linear"],
                        ["get", "happening"],
                        0,
                        "hsl(0, 58%, 44%)",
                        70.161,
                        "hsla(123, 62%, 39%, 0)",
                        83.326,
                        "hsl(123, 62%, 39%)"
                    ],
                    'fill-opacity': 1
                }
            }
        );
        map.addLayer(
            {
                'id': 'Climate Change is Human Caused',
                'source': 'yale',
                'source-layer': 'yale-climate-opinion-map-1he0ht',
                'maxzoom': zoomThreshold,
                'type': 'fill',
                // only include features for which the "isState"
                // property is "true"
                'paint': {
                    'fill-color': [
                        "interpolate",
                        ["linear"],
                        ["get", "human"],
                        0,
                        "#b12f2f",
                        55.104,
                        "hsla(123, 62%, 39%, 0)",
                        64.687,
                        "#26a12c"
                    ],
                    'fill-opacity': 1
                }
            }
        );
        map.addLayer(
            {
                'id': 'Climate Change will Harm me Personally',
                'source': 'yale',
                'source-layer': 'yale-climate-opinion-map-1he0ht',
                'maxzoom': zoomThreshold,
                'type': 'fill',
                // only include features for which the "isState"
                // property is "true"
                'paint': {
                    'fill-color': [
                        "interpolate",
                        ["linear"],
                        ["get", "personal"],
                        0,
                        "#b12f2f",
                        43,
                        "hsla(123, 62%, 39%, 0)",
                        58.868,
                        "#26a12c"
                        ],
                    'fill-opacity': 1
                }
            }
        );
        map.addLayer(
            {
                'id': 'Climate Change will Harm People in the US',
                'source': 'yale',
                'source-layer': 'yale-climate-opinion-map-1he0ht',
                'maxzoom': zoomThreshold,
                'type': 'fill',
                // only include features for which the "isState"
                // property is "true"
                'paint': {
                    'fill-color': [
                        "interpolate",
                        ["linear"],
                        ["get", "harmUS"],
                        0,
                        "#b12f2f",
                        62,
                        "hsla(123, 62%, 39%, 0)",
                        75.508,
                        "#26a12c"
                        ],
                    'fill-opacity': 1
                }
            }
        );
        map.addLayer(
            {
                'id': 'Corporations should do more',
                'source': 'yale',
                'source-layer': 'yale-climate-opinion-map-1he0ht',
                'maxzoom': zoomThreshold,
                'type': 'fill',
                // only include features for which the "isState"
                // property is "true"
                'paint': {
                    'fill-color': [
                        "interpolate",
                        ["linear"],
                        ["get", "corporatio"],
                        0,
                        "#b12f2f",
                        68.8,
                        "hsla(123, 62%, 39%, 0)",
                        78.568,
                        "#26a12c"
                        ],
                    'fill-opacity': 1
                }
            }
        );
        map.addLayer(
            {
                'id': 'The President should do more',
                'source': 'yale',
                'source-layer': 'yale-climate-opinion-map-1he0ht',
                'maxzoom': zoomThreshold,
                'type': 'fill',
                // only include features for which the "isState"
                // property is "true"
                'paint': {
                    'fill-color': [
                        "interpolate",
                        ["linear"],
                        ["get", "president"],
                        0,
                        "#b12f2f",
                        50.8,
                        "hsla(123, 62%, 39%, 0)",
                        63.883,
                        "#26a12c"
                        ],
                    'fill-opacity': 1
                }
            }
        );

        // STATESATRISK
        map.addSource('reportCard', {
            'type': 'vector',
            'url': 'mapbox://megsprotte.54ydb0h3' 
        });
        map.addLayer(
            {
                'id': 'State Grade',
                'source': 'reportCard',
                'source-layer': 'reportcard-statesatrisk-2gkkla',
                'maxzoom': zoomThreshold,
                'type': 'fill',
                // only include features for which the "isState"
                // property is "true"
                'paint': {
                    'fill-color': [
                        "match",
                        ["get", "State_Grad"],
                        ["A"],
                        "#26a12c",
                        ["A-"],
                        "hsla(123, 62%, 39%, 0.8)",
                        ["B+"],
                        "hsla(123, 62%, 39%, 0.6)",
                        ["B"],
                        "hsla(123, 62%, 39%, 0.4)",
                        ["B-"],
                        "hsla(123, 62%, 39%, 0.2)",
                        ["C+"],
                        "hsla(123, 62%, 39%, 0)",
                        ["C"],
                        "hsla(0, 58%, 44%, 0)",
                        ["C-"],
                        "hsla(0, 58%, 44%, 0.2)",
                        ["D+"],
                        "hsla(0, 58%, 44%, 0.4)",
                        ["D"],
                        "hsla(0, 58%, 44%, 0.6)",
                        ["D-"],
                        "hsla(0, 58%, 44%, 0.8)",
                        ["F"],
                        "#b12f2f",
                        "hsl(275, 6%, 97%)"
                    ],
                    'fill-opacity': 1
                }
            }
        );

        // GHG TARGETS
        map.addSource('ghg-targets', {
            'type': 'vector',
            'url': 'mapbox://megsprotte.2v2og34k'
        });
        map.addLayer(
            {
                'id': 'GHG Emissions Targets',
                'source': 'ghg-targets',
                'source-layer': 'ghg-emissions-targets-2jdjeb',
                'maxzoom': zoomThreshold,
                'type': 'fill',
                'paint': {
                    'fill-color': [
                        "match",
                        ["get", "GHG_Emis_1"],
                        ["N/A"],
                        "hsla(0, 58%, 44%, 0.7)",
                        ["STATUTORY TARGET"],
                        "hsla(123, 62%, 39%, 0.25)",
                        ["EXECUTIVE TARGET"],
                        "hsla(123, 62%, 39%, 0.25)",
                        [
                            "STATUTORY AND EXECUTIVE TARGETS"
                        ],
                        "hsla(123, 62%, 39%, 0.7)",
                        "#000000"
                    ],
                    'fill-opacity': 1
                }
            }
        );

        // CARBON INTENSITY
        map.addSource('carbon-intensity', {
            'type': 'vector',
            'url': 'mapbox://megsprotte.a1wltdji'
        });

        // PER CAPITA CO2
        map.addSource('per-capita-co2', {
            'type': 'vector',
            'url': 'mapbox://megsprotte.crbe6x8s'
        });

        // ENERGY INTENSITY BY STATE
        map.addSource('energy-intensity', {
            'type': 'vector',
            'url': 'mapbox://megsprotte.5rhd0yzk'
        });
        
    });

    map.on('idle', () => {        
        // Enumerate ids of the layers.
        const toggleableLayerIds = ['GHG Emissions Targets', 'Climate Change is Happening', 'Climate Change is Human Caused', 'Climate Change will Harm me Personally', 'Climate Change will Harm People in the US', 'Corporations should do more', 'The President should do more', 'State Grade'];
        
        // Set up the corresponding toggle button for each layer.
        for (const id of toggleableLayerIds) {
        // Skip layers that already have a button set up.
        if (document.getElementById(id)) {
        continue;
        }
        
        // Create a link.
        const link = document.createElement('a');
        link.id = id;
        link.href = '#';
        link.textContent = id;
        link.className = 'active';
        
        // Show or hide layer when the toggle is clicked.
        link.onclick = function (e) {
        const clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();
        
        const visibility = map.getLayoutProperty(
        clickedLayer,
        'visibility'
        );
        
        // Toggle layer visibility by changing the layout object's visibility property.
        if (visibility === 'visible') {
        map.setLayoutProperty(clickedLayer, 'visibility', 'none');
        this.className = '';
        } else {
        this.className = 'active';
        map.setLayoutProperty(
        clickedLayer,
        'visibility',
        'visible'
        );
        }
        };
        
        const layersBeliefs = document.getElementById('menu-beliefs');
        const layersPolicy = document.getElementById('menu-policy');
        if (['Climate Change is Happening', 'Climate Change is Human Caused', 'Climate Change will Harm me Personally', 'Climate Change will Harm People in the US', 'Corporations should do more', 'The President should do more'].includes(link.id))
        {
            layersBeliefs.appendChild(link);
        }
        if(['State Grade', 'GHG Emissions Targets'].includes(link.id)){layersPolicy.appendChild(link);}
        }
        });
</script>

</body>
</html>